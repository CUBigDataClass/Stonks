# Pulling ubuntu image with a specific tag from the docker hub.
FROM ubuntu:20.04

WORKDIR /
# Create the log file to be able to run tail
RUN touch var/log/cron.log

# Add crontab file in the cron directory and give execution rights
ADD crontab_newsapi etc/cron.d/crontab_newsapi
RUN chmod 0744 etc/cron.d/crontab_newsapi

# RUN chmod 0744 /the_script
# RUN chmod 0744 /the_script
# RUN chmod 0777 /the_script
#RUN chmod 0644 /etc/cron.d/crontab_newsapi


WORKDIR /root
# Updating the packages and installing cron, python3-pip, newsapi
RUN apt-get update
#RUN apt-get -y upgrade
RUN apt-get -y install cron
RUN apt-get -y install python3-pip
RUN apt-get -y install vim
#RUN python3 -m pip install -r requirements_docker.txt

WORKDIR /root
# Copy python files to root directory
COPY all_articles_bloomberg.py all_articles_bloomberg.py 
COPY dailystock.py dailystock.py
COPY keys.py keys.py
COPY last_request_date.py last_request_date.py
COPY request_parameters.py request_parameters.py

WORKDIR /root
# Copy and give run.sh exec rights
COPY run_newsapi.sh run_newsapi.sh
COPY run_stockdata.sh run_stockdata.sh
RUN chmod 0744 run_newsapi.sh
RUN chmod 0744 run_stockdata.sh

# RUN chmod 0744 /the_script
# RUN chmod 0777 /the_script
# RUN chmod +x /root/run_newsapi.sh
# RUN chmod +x /root/run_stockdata.sh


# https://stackoverflow.com/questions/37458287/how-to-run-a-cron-job-inside-a-docker-container
# Run the command on container startup
#CMD ["cron", "-f"]
CMD cron && tail -f /var/log/cron.log
